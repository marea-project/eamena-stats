<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>E39N28-13 | EAMENA Stats</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-ocean-floor.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-ocean-floor.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.16/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/_esm.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/_esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/grids/E39N28-13.json", {"name":"./data/grids/E39N28-13.json","mimeType":"application/json","path":"./_file/data/grids/E39N28-13.7ea840e1.json","lastModified":1737106371535});

define({id: "aa1ff927", inputs: ["FileAttachment","view","Inputs","htl"], outputs: ["grid_data","summarise_tiles","summarise_damage","role_expand","site_sel"], body: async (FileAttachment,view,Inputs,htl) => {
const grid_data = await FileAttachment("./data/grids/E39N28-13.json").json();

function summarise_tiles(item)
{
	console.log(item);

	var intret = {};
	var ret = [];
	for(var i=0; i < item.length; i++)
	{
		for(var j=0; j < item[i].Tiles.length; j++)
		{
			const kv = item[i].Tiles[j];
			const k = kv[0];
			const v = parseInt(kv[1]);
			if(!(k in intret)) { intret[k] = 0; }
			intret[k] = intret[k] + v;
		}
	}
	console.log(intret);
	for (const [key, value] of Object.entries(intret))
	{
		ret.push({'label': key, 'records': value})
	}
	return ret;
}

function summarise_damage(item)
{
	console.log(item);

	var intret = {};
	var ret = [];
	for(var i=0; i < item.length; i++)
	{
		for(var j=0; j < item[i].Disturbances.length; j++)
		{
			const k = item[i].Disturbances[j];
			const v = 1;
			if(!(k in intret)) { intret[k] = 0; }
			intret[k] = intret[k] + v;
		}
	}
	console.log(intret);
	for (const [key, value] of Object.entries(intret))
	{
		ret.push({'label': key, 'records': value})
	}
	return ret;
}

function role_expand(role)
{
	if(role.constructor.name == "Array")
	{
		var ret = Array();
		for(var i = 0; i < role.length; i++)
		{
			ret.push(role[i].label);
		}
		return ret.join(', ');
	}
	return role.label;
}

const site_sel = view(Inputs.table(grid_data['sites'], {
        columns: ['Label', 'Role', 'Date', 'Tiles', 'ID'],
        header: {'Label': 'EAMENA ID', 'Date': 'Assessment Date(s)', 'Tiles': 'Assessments', 'ID': ''},
        format: {
                'ID': (x) => htl.html`<a href="https://database.eamena.org/report/${ x }">EAMENA Link</a>`,
                'Role': (x) => htl.html`${ role_expand(x) }`,
		'Tiles': (x) => htl.html`${ x.length }`,
        },
  }));

return {grid_data,summarise_tiles,summarise_damage,role_expand,site_sel};
}});

define({id: "bacb24d4", inline: true, inputs: ["resize","Plot","summarise_tiles","site_sel","display"], body: async (resize,Plot,summarise_tiles,site_sel,display) => {
display(await(
    resize((width) => Plot.plot({
        label: "Resource Instance Components",
        marginLeft: 250,
        marginRight: 30,
        width: width,
        x: { axis: null },
        y: { axis: null },
        marks: [
                Plot.barX(summarise_tiles(site_sel), {
                        x: "records",
                        y: "label",
                        color: { legend: false },
                        fill: "label"
                }),
                Plot.text(summarise_tiles(site_sel), {
                        text: d => `${ d.records }`,
                        x: "records",
                        y: "label",
                        textAnchor: "start",
                        dx: 3,
                        fill: "white"
                }),
                Plot.text(summarise_tiles(site_sel), {
                        text: d => d.label,
                        textAnchor: "end",
                        x: 0,
                        y: "label",
                        dx: -3,
                        fill: "white"
                })
        ]
    }))
  
))
}});

define({id: "47db1845", inline: true, inputs: ["resize","Plot","summarise_damage","site_sel","display"], body: async (resize,Plot,summarise_damage,site_sel,display) => {
display(await(
    resize((width) => Plot.plot({
        label: "Disturbance Causes",
        marginLeft: 250,
        marginRight: 30,
        width: width,
        x: { axis: null },
        y: { axis: null },
        marks: [
                Plot.barX(summarise_damage(site_sel), {
                        x: "records",
                        y: "label",
                        color: { legend: false },
                        fill: "label"
                }),
                Plot.text(summarise_damage(site_sel), {
                        text: d => `${ d.records }`,
                        x: "records",
                        y: "label",
                        textAnchor: "start",
                        dx: 3,
                        fill: "white"
                }),
                Plot.text(summarise_damage(site_sel), {
                        text: d => d.label,
                        textAnchor: "end",
                        x: 0,
                        y: "label",
                        dx: -3,
                        fill: "white"
                })
        ]
    }))
  
))
}});

</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1 id="e39n28-13" tabindex="-1"><a class="observablehq-header-anchor" href="#e39n28-13">E39N28-13</a></h1>
<div id="cell-aa1ff927" class="observablehq observablehq--block"></div>
  <h2>Grid Completeness</h2>
  <div class="card"><span id="cell-bacb24d4" class="observablehq--loading"></span></div>
  <h2>Disturbance Causes</h2>
  <div class="card"><span id="cell-47db1845" class="observablehq--loading"></span></div>
</main>
<footer id="observablehq-footer">
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-01-17T09:34:18">Jan 17, 2025</a>.</div>
</footer>
</div>
